syntax = "proto3";

package auth.v1;

option go_package = "gen/auth/v1;authv1";

service AuthService {
  rpc Login(LoginRequest) returns (LoginResponse);
  rpc HandleCallback(HandleCallbackRequest) returns (HandleCallbackResponse);
  rpc Logout(LogoutRequest) returns (LogoutResponse);
  rpc GetSession(GetSessionRequest) returns (GetSessionResponse);
  rpc GetUser(GetUserRequest) returns (GetUserResponse);
  rpc GetUserByUsername(GetUserByUsernameRequest) returns (GetUserByUsernameResponse);
  rpc GetCurrentUser(GetCurrentUserRequest) returns (GetCurrentUserResponse);
}

// OIDCProvider represents an external OpenID Connect identity provider.
enum OIDCProvider {
  // OIDC_PROVIDER_UNSPECIFIED should not be used.
  OIDC_PROVIDER_UNSPECIFIED = 0;

  // Google as an OIDC provider.
  OIDC_PROVIDER_GOOGLE = 1;
}

// Session represents an authenticated user session.
message Session {
  // Unique session identifier managed by the auth module.
  string session_id = 1;
  string user_id = 2;
  int64 created_at = 3;
  int64 expires_at = 4;
}

// Login and session management messages.
message LoginRequest {
  OIDCProvider provider = 1;
  string redirect_uri = 2;
  string state = 3;
}

message LoginResponse {
  string auth_url = 1;
  string state = 2;
}

message HandleCallbackRequest {
  string code = 1;
  string state = 2;
  OIDCProvider provider = 3;
}

message HandleCallbackResponse {}

message LogoutRequest {}

message LogoutResponse {
  bool success = 1;
}

message GetSessionRequest {}

message GetSessionResponse {}

// User profile and lookup messages.
message User {
  // Service-internal user ID.
  string user_id = 1;
  // Unique username/handle used inside the service.
  string username = 2;
  // Display name shown in the UI.
  string display_name = 3;
}

message GetUserRequest {
  // Service-internal user ID.
  string user_id = 1;
}

message GetUserResponse {
  User user = 1;
}

message GetUserByUsernameRequest {
  // Unique username/handle used inside the service.
  string username = 1;
}

message GetUserByUsernameResponse {
  User user = 1;
}

message GetCurrentUserRequest {}

message GetCurrentUserResponse {
  User user = 1;
}
